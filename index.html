<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ãƒ„ãƒãƒ¡ã‚«ãƒƒãƒ—2025 æŠ€ãƒã‚§ãƒƒã‚¯ï¼†ç·¨æˆ</title>

<style>
body {
  font-family: sans-serif;
  font-size: 15px;
  padding: 12px;
  background: #f6faff;
  padding-top: 90px;   /* ä¸Šéƒ¨ãƒãƒ¼ï¼‹æ¤œç´¢ãƒãƒ¼ã¶ã‚“ */
  padding-bottom: 80px;/* ä¸‹éƒ¨ãƒŸãƒ‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¶ã‚“ */
  box-sizing: border-box;
}

h1 {
  font-size: 20px;
  margin-bottom: 6px;
}

/* ä¸Šéƒ¨ãƒ¢ãƒ¼ãƒ‰ãƒãƒ¼ */
.mode-bar {
  display: flex;
  gap: 6px;
  margin-bottom: 8px;
  flex-wrap: wrap;
}
.mode-btn {
  flex: 1;
  min-width: 90px;
  padding: 8px 4px;
  font-size: 13px;
  border-radius: 6px;
  border: 1px solid #0a84ff;
  background: white;
  color: #0a84ff;
}
.mode-btn.active {
  background: #0a84ff;
  color: white;
}

/* æ¤œç´¢ãƒãƒ¼ï¼ˆäºˆé¸å°‚ç”¨ï¼‰ */
.search-bar {
  margin: 6px 0 10px;
  display: flex;
  align-items: center;
  gap: 6px;
}
.search-bar label {
  font-size: 13px;
  white-space: nowrap;
}
.search-input {
  flex: 1;
  padding: 6px 8px;
  font-size: 14px;
  border-radius: 6px;
  border: 1px solid #ccc;
}

/* ç‚¹æ•°ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
.section-title {
  margin-top: 18px;
  font-weight: bold;
  font-size: 17px;
  border-left: 5px solid #0a84ff;
  padding-left: 6px;
}

/* æŠ€ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ  */
.tech-item {
  background: white;
  margin: 4px 0;
  padding: 10px;
  border-radius: 6px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 6px;
  border: 1px solid transparent;
}

/* æ¤œç´¢ãƒ’ãƒƒãƒˆæ™‚ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆäºˆé¸ã®ã¿ï¼‰ */
.tech-item.search-hit {
  background: #fff6cc;
  border-color: #ffcc66;
}

.tech-title {
  font-size: 15px;
}
.tech-pt-label {
  font-size: 11px;
  color: #666;
}
.tech-controls {
  display: flex;
  align-items: center;
  gap: 12px;
  min-width: 120px;
  justify-content: flex-end;
}
.maincheck-label,
.multilabel {
  font-size: 11px;
  white-space: nowrap;
}

/* äºˆé¸ç‚¹å…¥åŠ› */
.pre-box {
  margin-top: 15px;
  background: #e6f4ff;
  padding: 8px;
  border-radius: 6px;
  font-size: 14px;
}
.pre-input {
  width: 80px;
  padding: 3px;
  font-size: 15px;
}

/* ä¸Šéƒ¨å›ºå®šã‚¹ã‚³ã‚¢ãƒãƒ¼ */
.total-bar {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  padding: 4px 8px;
  background: rgba(240, 240, 240, 0.96);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  box-sizing: border-box;
  z-index: 200;
  transition: background 0.3s ease;
}
.total-box {
  display: flex;
  flex-direction: column;
  gap: 4px;
}
.total-top-row {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  align-items: center;
}
.total-chip {
  background: rgba(255, 255, 255, 0.9);
  padding: 2px 6px;
  border-radius: 999px;
  font-size: 11px;
}
.total-main {
  font-size: 15px;
  font-weight: bold;
}
.total-buttons {
  display: flex;
  gap: 4px;
  margin-top: 4px;
}
.total-buttons button {
  flex: 1;
  padding: 4px;
  font-size: 11px;
}

button {
  border: none;
  border-radius: 6px;
  cursor: pointer;
}

.warning {
  color: red;
  font-weight: bold;
  display: none;
  font-size: 12px;
  margin-bottom: 5px;
}

/* ãƒ¢ãƒ¼ãƒ‰åˆ¥ã‚³ãƒ³ãƒ†ãƒŠ */
.mode-section {
  display: none;
}
.mode-section.active {
  display: block;
}

/* ç·¨æˆãƒªã‚¹ãƒˆ */
.order-box {
  margin-top: 10px;
  background: #ffffff;
  padding: 8px;
  border-radius: 6px;
  border: 1px solid #ddd;
}
.order-box-title {
  font-size: 13px;
  margin-bottom: 4px;
}
.order-list {
  list-style: none;
  padding: 0;
  margin: 0;
}
.order-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 6px;
  padding: 4px 4px;
  border-bottom: 1px solid #eee;
  font-size: 13px;
}
.order-controls {
  display: flex;
  gap: 4px;
}
.order-btn {
  font-size: 11px;
  padding: 2px 6px;
  border-radius: 4px;
  border: 1px solid #999;
  background: #f5f5f5;
}
.order-btn-del {
  border-color: #ff6666;
  background: #ffdddd;
  color: #c00000;
}
.order-btn-move {
  border-color: #0a84ff;
  background: #e2f0ff;
  color: #004a99;
}

/* äºˆé¸åˆè¨ˆ */
.pre-sum {
  margin-top: 6px;
  font-size: 13px;
  font-weight: bold;
}

/* ä¸‹éƒ¨ãƒŸãƒ‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
.mini-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #ffffff;
  box-shadow: 0 -1px 6px rgba(0,0,0,0.15);
  display: flex;
  justify-content: space-around;
  padding: 4px 0;
  z-index: 180;
}
.mini-btn {
  flex: 1;
  background: transparent;
  border: none;
  font-size: 11px;
  color: #555;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}
.mini-btn-icon {
  font-size: 17px;
}
.mini-btn.active {
  color: #0a84ff;
}

/* å°åˆ·æ™‚ã¯ãƒãƒ¼ã¨ãƒŸãƒ‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æ¶ˆã™ */
@media print {
  .total-bar,
  .mini-nav {
    display: none !important;
  }
  body {
    padding-top: 0;
    padding-bottom: 0;
  }
}
</style>
</head>

<body>

<!-- ä¸Šéƒ¨å›ºå®šã‚¹ã‚³ã‚¢ãƒãƒ¼ -->
<div class="total-bar" id="total-bar">
  <div class="total-box">
    <div class="total-top-row">
      <div class="total-chip">æŠ€æ•°ï¼š<span id="selected-count">0</span></div>
      <div class="total-chip">äºˆé¸ï¼š<span id="pre-total">0</span></div>
      <div class="total-chip">FMDï¼š<span id="fmd-total">0</span></div>
      <div class="total-chip">åŸºç¤ï¼š<span id="base-total">0</span></div>
    </div>
    <div class="total-main">
      ç·åˆè¨ˆï¼š<span id="final-total">0</span>
    </div>
    <div class="total-buttons">
      <button style="background:#0a84ff;color:#fff;" onclick="resetAll()">ãƒªã‚»ãƒƒãƒˆ</button>
      <button style="background:#555;color:#fff;" onclick="openPrintView()">å°åˆ·</button>
    </div>
  </div>
</div>

<h1>ãƒ„ãƒãƒ¡ã‚«ãƒƒãƒ—2025 æŠ€ãƒã‚§ãƒƒã‚¯ï¼†ç·¨æˆ</h1>

<!-- æŠ€æ¤œç´¢ãƒãƒ¼ï¼ˆäºˆé¸ã®ã¿å¯¾è±¡ï¼‰ -->
<div class="search-bar">
  <label for="trick-search">äºˆé¸æŠ€æ¤œç´¢ï¼š</label>
  <input id="trick-search" class="search-input" type="text"
         placeholder="äºˆé¸æŠ€åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šç‡ˆç± , ã¸ã³ï¼‰" />
</div>

<!-- ä¸Šéƒ¨ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ -->
<div class="mode-bar">
  <button class="mode-btn active" data-mode="score">æ±ºå‹ã‚¹ã‚³ã‚¢</button>
  <button class="mode-btn" data-mode="finals">æ±ºå‹ç·¨æˆ</button>
  <button class="mode-btn" data-mode="prelims">äºˆé¸ç·¨æˆ</button>
</div>

<p class="warning" id="warn">âš  æŠ€ã¯30å€‹ã¾ã§ã—ã‹é¸ã¹ã¾ã›ã‚“</p>

<!-- æ±ºå‹ã‚¹ã‚³ã‚¢ãƒ¢ãƒ¼ãƒ‰ -->
<div id="mode-score" class="mode-section active">
  <div id="tech-list"></div>

  <div class="pre-box">
    äºˆé¸ç‚¹ï¼ˆ0ã€œ112ï¼‰ï¼š
    <input type="number" id="pre-score" class="pre-input" value="0" min="0" max="112" />
    <p class="warning" id="pre-warn">âš  äºˆé¸ã¯0ã€œ112ç‚¹ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>
  </div>
</div>

<!-- æ±ºå‹ç·¨æˆãƒ¢ãƒ¼ãƒ‰ -->
<div id="mode-finals" class="mode-section">
  <p style="font-size:13px;">
    æ±ºå‹ã‚¹ã‚³ã‚¢ãƒ¢ãƒ¼ãƒ‰ã§ã€Œä½¿ç”¨ã€ã«ãƒã‚§ãƒƒã‚¯ã—ãŸæœ€å¤§30æŠ€ã‚’èª­ã¿è¾¼ã¿ã€é †ç•ªã‚’ä¸¦ã¹æ›¿ãˆã¾ã™ã€‚
  </p>
  <button id="load-finals-btn" style="background:#0a84ff;color:white;width:100%;padding:8px;">
    æ±ºå‹æŠ€ã‚’èª­ã¿è¾¼ã‚€
  </button>
  <div class="order-box">
    <div class="order-box-title">æ±ºå‹ç·¨æˆï¼ˆ<span id="finals-count">0</span>æŠ€ï¼‰</div>
    <ul id="finals-list" class="order-list"></ul>
    <p style="font-size:11px;opacity:0.7;margin-top:4px;">
      å·¦ï¼šâ†‘ï¼ˆä¸Šã¸ï¼‰ï¼ ä¸­å¤®ï¼šâ†“ï¼ˆä¸‹ã¸ï¼‰ï¼ å³ï¼šâœ•ï¼ˆå‰Šé™¤ï¼‰
    </p>
  </div>
</div>

<!-- äºˆé¸ç·¨æˆãƒ¢ãƒ¼ãƒ‰ -->
<div id="mode-prelims" class="mode-section">
  <p style="font-size:13px;">
    äºˆé¸ç”¨ã®æŠ€ã‚’<strong>12å€‹ã¾ã§</strong>é¸ã³ã€ç¬¬1ãƒ©ã‚¦ãƒ³ãƒ‰6å€‹ãƒ»ç¬¬2ãƒ©ã‚¦ãƒ³ãƒ‰6å€‹ã«åˆ†ã‘ã¦ä¸¦ã¹æ›¿ãˆã¾ã™ã€‚
  </p>

  <div class="warning" id="prelimit-warn">âš  äºˆé¸ã§é¸ã¹ã‚‹æŠ€ã¯12å€‹ã¾ã§ã§ã™ã€‚</div>

  <div id="pre-tech-list"></div>

  <button id="apply-prelims-btn" style="background:#0a84ff;color:white;width:100%;padding:8px;">
    é¸æŠæŠ€ã‚’äºˆé¸ã¸åæ˜ 
  </button>

  <div class="order-box">
    <div class="order-box-title">ç¬¬1ãƒ©ã‚¦ãƒ³ãƒ‰ï¼ˆ<span id="prelims1-count">0</span>æŠ€ï¼‰</div>
    <ul id="prelims1-list" class="order-list"></ul>
  </div>

  <div class="order-box">
    <div class="order-box-title">ç¬¬2ãƒ©ã‚¦ãƒ³ãƒ‰ï¼ˆ<span id="prelims2-count">0</span>æŠ€ï¼‰</div>
    <ul id="prelims2-list" class="order-list"></ul>
  </div>

  <p class="pre-sum">
    äºˆé¸æŠ€ åŸºç¤ç‚¹åˆè¨ˆï¼š<span id="pre-tech-total">0</span> ç‚¹
  </p>
</div>

<!-- ã‚¹ãƒãƒ›ä¸‹å›ºå®šãƒŸãƒ‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
<div class="mini-nav">
  <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ãƒœã‚¿ãƒ³ -->
  <button class="mini-btn active" data-mode="score">
    <span class="mini-btn-icon">ğŸ§®</span>
    <span>æ±ºå‹</span>
  </button>
  <button class="mini-btn" data-mode="finals">
    <span class="mini-btn-icon">ğŸ¯</span>
    <span>æ±ºå‹ç·¨æˆ</span>
  </button>
  <button class="mini-btn" data-mode="prelims">
    <span class="mini-btn-icon">ğŸ</span>
    <span>äºˆé¸ç·¨æˆ</span>
  </button>
  <!-- å¤–éƒ¨ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ -->
  <button class="mini-btn" data-link="judge">
    <span class="mini-btn-icon">ğŸ“˜</span>
    <span>æˆåŠŸåŸºæº–</span>
  </button>
  <button class="mini-btn" data-link="official">
    <span class="mini-btn-icon">ğŸŒ</span>
    <span>å…¬å¼HP</span>
  </button>
</div>

<script>
/* --- æŠ€ãƒ‡ãƒ¼ã‚¿ --- */
const tricks = {
  1:["ç´ã‹ã‘æ‰‹ä¹—ã›","ãŠæ‰‹ç‰","ã©ã˜ã‚‡ã†ã™ãã„","ãƒ¡ãƒªãƒ¼ã‚´ãƒ¼ãƒ©ãƒ³ãƒ‰","åˆè©£","æ‰‹ä¹—ã›ã‚¸ãƒ£ãƒ³ãƒ—","è„šä¸‹ã‹ã‚‰å›ã™","ç·šé¦™èŠ±ç«","ãƒ–ãƒ¼ãƒ¡ãƒ©ãƒ³ã‚­ãƒ£ãƒƒãƒ","ãƒ™ãƒ«ãƒˆ"],
  2:["ã¤ã°ã‚è¿”ã—","ã²ã°ã‚Šè¿”ã—","ãƒªãƒ•ãƒ†ã‚£ãƒ³ã‚°","ã¤ãªã‚ãŸã‚Š","ç´ã®ã›","æ—¥æœ¬ä¸€å‘¨","ãƒ„ã‚¤ã‚¹ãƒˆç‰‡é“","ãŠæ‰‹ç‰è¶³æŠœã","ã‚«ãƒ¡ãƒ¬ã‚ªãƒ³","ãƒ•ãƒƒã‚¯"],
  3:["ãƒˆãƒ³ãƒãƒ«ã¤ãªã‚ãŸã‚Š","è…°ã‹ã‘","æ‰‹ã‹ã‚‰ãƒ¡ãƒªãƒ¼ã‚´ãƒ¼ãƒ©ãƒ³ãƒ‰ï¼ˆ3å‘¨ï¼‰","ãƒ„ã‚¤ã‚¹ãƒˆå¾€å¾©","ãƒˆãƒ©ãƒ³ãƒãƒªãƒ³ï¼ˆ3å›ï¼‰","ãŠã¡ã‚‡ã“","ã‚¿ã‚±ã‚³ãƒ—ã‚¿ãƒ¼","äºŒæ®µã‚´ãƒ","ã‚µãƒ³ã‚ºï¼ˆ1å›ï¼‰","ç‡ˆç± ","ã‚¯ãƒ­ã‚¹ã‚­ãƒ£ãƒƒãƒ"],
  4:["æŒ‡ã®ã›","å¤§è»Šè¼ª","ã‹ã–ãã‚‹ã¾","ç«œå·»","ã¸ã³ï¼ˆ3å‘¨ï¼‰","ç‰›è‹¥ä¸¸ç‰‡é“","æ¸¦æ½®ï¼ˆä¸Šä¸‹2å›ï¼‰","ãƒ¡ãƒ€ãƒ«","èˆå¦“ã‹ã‘","ã‚³ãƒ¡ã‚¿","ãƒ ãƒ1å›","èƒ´å›ã—","è„šããã—ï¼ˆ1å›ï¼‰"],
  5:["ç ‚æ™‚è¨ˆ","ã¯ã‚„ã¶ã•è¿”ã—","é¯‰ã®æ»ç™»ã‚Š","ä¸¡æ‰‹ã¸ã³","è¶³ã‹ã‘","ç©ºä¸­å¤§è»Šè¼ª","è¶³ä¹—ã›","ç¸¦ã¸ã³3å‘¨","ã‚·ãƒ³ã‚°ãƒ«ã‚¯ãƒ­ãƒƒã‚¯","ãƒãƒ§ãƒƒãƒ—ã‚¹ãƒ†ã‚£ãƒƒã‚¯","ãƒªã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼å‹ã‚°ãƒªãƒ¼ãƒ³ãƒˆãƒ©ã‚¤ã‚¢ãƒ³ã‚°ãƒ«","ã‚¼ãƒ­ã‚¹ã‚¿","ã‚¯ãƒ­ã‚¹ã‚­ãƒ£ãƒƒãƒãƒ•ã‚©ãƒ¼ãƒ«","ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆç¶±æ¸¡ã‚Š"],
  6:["åœ°ç„è»Š3å‘¨","ç™½åˆƒå–ã‚Š","ç‡•å°¾è¿”ã—","ã‚ªãƒ¼ãƒ—ãƒ³ã‚¦ã‚£ãƒƒãƒ—1å›","èƒŒããã—1å›","ãƒˆãƒ«ãƒãƒ¼ãƒ‰1å›","ãƒªãƒ•ãƒ†ã‚£ãƒ³ã‚°ã€œç›´å¤§è»Šè¼ª","ãƒ”ãƒ«ã‚¨ãƒƒãƒˆï¼ˆã²ã‚‚ã®ã›ã€œã²ã‚‚ã®ã›ï¼‰","ã‚¶ãƒªã‚¬ãƒ‹é‡£ã‚Š","ç‰‡ç™½åˆƒ","ç™»ã‚Šé¾ï¼ˆ5å‘¨ï¼‰"],
  7:["é–éŒ","å¤œå‰è»Š","é¦–åˆ‡ã‚Šã€œè…°åˆ‡ã‚Šã€œè„šåˆ‡ã‚Š","å¿è€…","è„šããã— in out","ã‹ã¾ã„ãŸã¡3ã‚»ãƒƒãƒˆ in ä¸¡æ‰‹ã¸ã³","ãƒ¬ãƒ¼ãƒ«","ã‚€ã¡3","ã‚¼ãƒ­ã‚¹ã‚¿ã‚¦ã‚£ãƒƒãƒ—","ãƒªãƒªãƒ¼ã‚¹ã‚¹ã‚¿ãƒ¼ãƒˆ","ã‚¹ãƒˆãƒªãƒ³ã‚°ãƒˆãƒ«ãƒãƒ¼ãƒ‰","ã‚ªãƒ­ãƒ"],
  8:["åŒæ™‚2å€‹ç©ºä¸­æ‰‹ã®ã›","ãã‚‹ã‚Šã‚“ã±ï¼ˆ3å›ï¼‰","èƒŒé¢ãƒ ãƒ","ã‹ã¾ã„ãŸã¡3ã‚»ãƒƒãƒˆã€œå¤ªé™½ç³»1å‘¨","ç¸¦ã¸ã³4å‘¨ã€œç¯ç± ","æ­¯è»Š","äºŒå›è»¢ç™½åˆƒå–ã‚Š","ç ‚æ™‚è¨ˆã€œè£ç‡ˆç± ","Vãƒ¬ãƒ¼ãƒ«ï¼ˆ2å›ï¼‰","èƒŒé¢ãƒãƒ§ãƒƒãƒ—ã‚¹ãƒ†ã‚£ãƒƒã‚¯","ä¾ã‚¦ã‚£ãƒƒãƒ—","ä¾ã‚­ãƒ£ãƒƒãƒ","ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚€ã¡3","ã¸ã³2å¾€å¾©","è„šä¸‹ã‚ªãƒ¼ãƒ—ãƒ³ã‚¦ã‚£ãƒƒãƒ—","ãƒ‹ã‚·ã‚­ãƒ˜ãƒ“","èƒŒé¢ç‡ˆç± "],
  9:["ãƒªãƒ¥ã‚¦ã‚°ã‚¦ãƒãƒ„ã‚«ã‚¤","ã‚¦ãƒ­ãƒœãƒ­ã‚¹","ã‚¹ãƒ©ãƒƒã‚¯ãƒ©ã‚¤ãƒ³","èƒŒé¢ã‚ªãƒ¼ãƒ—ãƒ³ã‚¦ã‚£ãƒƒãƒ—","èƒŒé¢ä¸¡æ‰‹ã¸ã³","ã‚µã‚¤ãƒ‰ãƒ¯ã‚¤ãƒ³ãƒ€ãƒ¼2.0","ä¸¡é¢ã¡ã‚‡ã‚“ã‹ã‘","å¤œåˆ€ç¥","ã‚¯ã‚¨ãƒ³ãƒ†ã‚£ãƒ³ãƒ»ã‚¦ã‚£ãƒƒãƒ—","æ¸¦æ½®ã€œç‡ˆç± ","4DEX","ãƒ•ãƒƒãƒˆã‚¯ãƒ©ãƒƒãƒ","ãƒ•ãƒƒãƒˆãƒˆã‚¹è›‡","ãƒ€ãƒ–ãƒ«ãƒ”ãƒ«ã‚¨ãƒƒãƒˆç™½åˆƒå–ã‚Š","ã‚¢ãƒ¼ãƒ ã‚°ãƒ©ã‚¤ãƒ³ãƒ‰ã‚¦ã‚£ãƒƒãƒ—","èƒŒé¢ãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚€ã¡3"],
 10:["ãƒ€ã‚¤ãƒ¬ã‚¯ç‡ˆç± ","2å€‹ã†ãšã—ãŠ3å›","ã¦ã˜ãªãƒ¼ã«ã‚ƒã‚€ã¡","ãƒ¤ãƒˆãƒœãƒ­ã‚¹"]
};

/* --- æ±ºå‹ã‚¹ã‚³ã‚¢ç”¨ãƒªã‚¹ãƒˆç”Ÿæˆ --- */
const scoreListWrap = document.getElementById("tech-list");
Object.keys(tricks).forEach(pt=>{
  const section=document.createElement("div");
  section.innerHTML=`<div class='section-title'>${pt}ç‚¹æŠ€</div>`;
  tricks[pt].forEach(name=>{
    const item=document.createElement("div");
    item.className="tech-item";
    item.innerHTML=`
      <div>
        <span class="tech-title">${name}</span><br>
        <span class="tech-pt-label">${pt}ç‚¹æŠ€</span>
      </div>
      <div class="tech-controls">
        <label class="multilabel"><input type="checkbox" class="multi">1.5å€</label>
        <label class="maincheck-label"><input type="checkbox" class="chk" data-pt="${pt}" data-name="${name}">ä½¿ç”¨</label>
      </div>`;
    section.appendChild(item);
  });
  scoreListWrap.appendChild(section);
});

/* --- äºˆé¸ç”¨ãƒªã‚¹ãƒˆç”Ÿæˆ --- */
const preTechWrap=document.getElementById("pre-tech-list");
Object.keys(tricks).forEach(pt=>{
  const section=document.createElement("div");
  section.innerHTML=`<div class='section-title'>${pt}ç‚¹æŠ€</div>`;
  tricks[pt].forEach(name=>{
    const item=document.createElement("div");
    item.className="tech-item";
    item.innerHTML=`
      <div>
        <span class="tech-title">${name}</span><br>
        <span class="tech-pt-label">${pt}ç‚¹æŠ€</span>
      </div>
      <div class="tech-controls">
        <label class="maincheck-label"><input type="checkbox" class="pre-chk" data-pt="${pt}" data-name="${name}">äºˆé¸</label>
      </div>`;
    section.appendChild(item);
  });
  preTechWrap.appendChild(section);
});

/* --- ã‚¹ã‚³ã‚¢è¨ˆç®— --- */
const warn = document.getElementById("warn");
const preWarn = document.getElementById("pre-warn");
const preInput = document.getElementById("pre-score");
const selectedSpan = document.getElementById("selected-count");
const fmdSpan = document.getElementById("fmd-total");
const baseSpan = document.getElementById("base-total");
const preSpan = document.getElementById("pre-total");
const finalSpan = document.getElementById("final-total");
const totalBar = document.getElementById("total-bar");

function formatScore(v){ return Number.isInteger(v)?v:v.toFixed(1); }

function getPreScore(){
  let v=parseFloat(preInput.value);
  if(isNaN(v)) v=0;
  let c=Math.min(Math.max(0,v),112);
  if(c!==v){ preInput.value=c; preWarn.style.display="block"; }
  else preWarn.style.display="none";
  return c;
}

function calcTotal(){
  const items=document.querySelectorAll("#mode-score .tech-item");
  let sel=0,fmd=0,base=0;
  items.forEach(it=>{
    const chk=it.querySelector(".chk");
    const multi=it.querySelector(".multi");
    if(chk.checked){
      sel++;
      const b=Number(chk.dataset.pt);
      let val=b*b;
      if(multi.checked) val*=1.5;
      fmd+=val;
      base+=b;
    }
  });

  if(sel>30) warn.style.display="block"; else warn.style.display="none";

  const pre=getPreScore();
  const finalBase=fmd+base;
  const total=finalBase+pre;

  selectedSpan.textContent=sel;
  fmdSpan.textContent=formatScore(fmd);
  baseSpan.textContent=formatScore(base);
  preSpan.textContent=formatScore(pre);
  finalSpan.textContent=formatScore(total);

  // ãƒãƒ¼è‰²ï¼†ç·åˆè¨ˆæ–‡å­—è‰²
  if(total>=2000){
    totalBar.style.background="black";
    finalSpan.style.color="white";
  } else {
    finalSpan.style.color="black";
    if(total>=1900) totalBar.style.background="red";
    else if(total>=1800) totalBar.style.background="purple";
    else if(total>=1700) totalBar.style.background="orange";
    else if(total>=1600) totalBar.style.background="dodgerblue";
    else if(total>=1500) totalBar.style.background="lightgreen";
    else totalBar.style.background="rgba(240,240,240,0.96)";
  }
}

// æ±ºå‹ä½¿ç”¨ãƒã‚§ãƒƒã‚¯åˆ¶é™
document.querySelectorAll(".chk").forEach(chk=>{
  chk.addEventListener("change",e=>{
    const c=document.querySelectorAll(".chk:checked");
    if(c.length>30 && e.target.checked){
      chk.checked=false;
      warn.textContent="âš  æŠ€ã¯30å€‹ã¾ã§ã—ã‹é¸ã¹ã¾ã›ã‚“";
      warn.style.display="block";
    }
    calcTotal();
  });
});
document.querySelectorAll(".multi").forEach(m=>m.addEventListener("change",calcTotal));
preInput.addEventListener("input",calcTotal);
calcTotal();

/* --- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼ˆä¸Šãƒãƒ¼ï¼‹ä¸‹ãƒŸãƒ‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼å…±é€šï¼‰ --- */
const modeButtons=document.querySelectorAll(".mode-btn");
const miniButtons=document.querySelectorAll(".mini-btn");
const sections={
  score:document.getElementById("mode-score"),
  finals:document.getElementById("mode-finals"),
  prelims:document.getElementById("mode-prelims")
};

function setMode(mode){
  Object.keys(sections).forEach(k=>{
    sections[k].classList.toggle("active",k===mode);
  });
  modeButtons.forEach(b=>{
    if(b.dataset.mode){
      b.classList.toggle("active",b.dataset.mode===mode);
    }
  });
  miniButtons.forEach(b=>{
    if(b.dataset.mode){
      b.classList.toggle("active",b.dataset.mode===mode);
    }
  });
  window.scrollTo({top:80, behavior:"smooth"});
}

// ãƒŸãƒ‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼†ä¸Šéƒ¨ãƒœã‚¿ãƒ³ã«å‹•ä½œã‚’å‰²ã‚Šå½“ã¦
modeButtons.forEach(btn=>{
  btn.addEventListener("click",()=>setMode(btn.dataset.mode));
});
miniButtons.forEach(btn=>{
  const mode=btn.dataset.mode;
  const link=btn.dataset.link;
  if(mode){
    btn.addEventListener("click",()=>setMode(mode));
  } else if(link==="judge"){
    btn.addEventListener("click",()=>{
      window.open(
        "https://drive.google.com/file/d/107A2MhR43epd7evpE5uHPbtyjd0BvZiS/view",
        "_blank"
      );
    });
  } else if(link==="official"){
    btn.addEventListener("click",()=>{
      window.open(
        "https://spingear.jp/index.php?dispatch=pages.view&page_id=140",
        "_blank"
      );
    });
  }
});

/* --- æ±ºå‹ç·¨æˆ --- */
const finalsList=document.getElementById("finals-list");
const finalsCountSpan=document.getElementById("finals-count");

function rebuildFinalsList(){
  finalsCountSpan.textContent=finalsList.querySelectorAll(".order-item").length;
}

document.getElementById("load-finals-btn").addEventListener("click",()=>{
  finalsList.innerHTML="";
  document.querySelectorAll(".chk:checked").forEach(chk=>{
    const name=chk.dataset.name;
    const pt=chk.dataset.pt;
    const li=document.createElement("li");
    li.className="order-item";
    li.innerHTML=`
      <span class="order-name">[${pt}ç‚¹] ${name}</span>
      <div class="order-controls">
        <button class="order-btn" data-act="up">â†‘</button>
        <button class="order-btn" data-act="down">â†“</button>
        <button class="order-btn order-btn-del" data-act="del">âœ•</button>
      </div>`;
    finalsList.appendChild(li);
  });
  rebuildFinalsList();
});

finalsList.addEventListener("click",e=>{
  if(!e.target.classList.contains("order-btn")) return;
  const act=e.target.dataset.act;
  const li=e.target.closest(".order-item");
  if(act==="up" && li.previousElementSibling){
    li.parentNode.insertBefore(li,li.previousElementSibling);
  }else if(act==="down" && li.nextElementSibling){
    li.parentNode.insertBefore(li.nextElementSibling,li);
  }else if(act==="del"){
    li.remove();
  }
  rebuildFinalsList();
});

/* --- äºˆé¸ç·¨æˆ --- */
const preLimitWarn=document.getElementById("prelimit-warn");
const preChecks=document.querySelectorAll(".pre-chk");
const applyPreBtn=document.getElementById("apply-prelims-btn");
const list1=document.getElementById("prelims1-list");
const list2=document.getElementById("prelims2-list");
const c1=document.getElementById("prelims1-count");
const c2=document.getElementById("prelims2-count");
const preSum=document.getElementById("pre-tech-total");

preChecks.forEach(chk=>{
  chk.addEventListener("change",e=>{
    const sel=document.querySelectorAll(".pre-chk:checked");
    if(sel.length>12 && e.target.checked){
      chk.checked=false;
      preLimitWarn.style.display="block";
    }else{
      preLimitWarn.style.display="none";
    }
  });
});

function updatePreSummary(){
  const getPoints=(nodes)=>{
    let sum=0;
    nodes.forEach(n=>{
      const m=n.textContent.match(/^\[(\d+)ç‚¹\]/);
      if(m) sum+=Number(m[1]);
    });
    return sum;
  };
  const n1=list1.querySelectorAll(".order-item .order-name");
  const n2=list2.querySelectorAll(".order-item .order-name");
  c1.textContent=n1.length;
  c2.textContent=n2.length;
  preSum.textContent=getPoints(n1)+getPoints(n2);
}

function makePreItem(pt,name,round){
  const li=document.createElement("li");
  const label=round===1?"2Râ–¶":"â—€1R";
  const move=round===1?"to2":"to1";
  li.className="order-item";
  li.innerHTML=`
    <span class="order-name">[${pt}ç‚¹] ${name}</span>
    <div class="order-controls">
      <button class="order-btn" data-act="up">â†‘</button>
      <button class="order-btn" data-act="down">â†“</button>
      <button class="order-btn order-btn-move" data-act="${move}">${label}</button>
      <button class="order-btn order-btn-del" data-act="del">âœ•</button>
    </div>`;
  return li;
}

applyPreBtn.addEventListener("click",()=>{
  list1.innerHTML="";
  list2.innerHTML="";
  const sel=[...document.querySelectorAll(".pre-chk:checked")];
  sel.forEach((chk,i)=>{
    const pt=chk.dataset.pt;
    const name=chk.dataset.name;
    if(i<6) list1.appendChild(makePreItem(pt,name,1));
    else list2.appendChild(makePreItem(pt,name,2));
  });
  updatePreSummary();
});

function preListHandler(e,listSelf,listOther){
  if(!e.target.classList.contains("order-btn")) return;
  const act=e.target.dataset.act;
  const li=e.target.closest(".order-item");
  if(act==="up" && li.previousElementSibling){
    li.parentNode.insertBefore(li,li.previousElementSibling);
  }else if(act==="down" && li.nextElementSibling){
    li.parentNode.insertBefore(li.nextElementSibling,li);
  }else if(act==="del"){
    li.remove();
  }else if(act==="to2" || act==="to1"){
    const txt=li.querySelector(".order-name").textContent;
    const m=txt.match(/^\[(\d+)ç‚¹\]\s*(.+)$/);
    const pt=m[1], name=m[2];
    li.remove();
    const target=(act==="to2"?list2:list1);
    target.appendChild(makePreItem(pt,name,act==="to2"?2:1));
  }
  updatePreSummary();
}

list1.addEventListener("click",e=>preListHandler(e,list1,list2));
list2.addEventListener("click",e=>preListHandler(e,list2,list1));

/* --- ãƒªã‚»ãƒƒãƒˆ --- */
function resetAll(){
  document.querySelectorAll(".chk").forEach(c=>c.checked=false);
  document.querySelectorAll(".multi").forEach(c=>c.checked=false);
  document.querySelectorAll(".pre-chk").forEach(c=>c.checked=false);
  preInput.value=0;
  warn.style.display="none";
  preWarn.style.display="none";
  preLimitWarn.style.display="none";
  list1.innerHTML="";
  list2.innerHTML="";
  finalsList.innerHTML="";
  updatePreSummary();
  rebuildFinalsList();
  calcTotal();
}

/* --- å°åˆ·ç”¨ --- */
function openPrintView(){
  const finals=[...finalsList.querySelectorAll(".order-item .order-name")].map(n=>n.textContent);
  const p1=[...list1.querySelectorAll(".order-item .order-name")].map(n=>n.textContent);
  const p2=[...list2.querySelectorAll(".order-item .order-name")].map(n=>n.textContent);

  const w=window.open("","_blank");
  if(!w) return;
  w.document.write(`
  <html><head><meta charset="UTF-8">
  <style>
    body{font-family:sans-serif;padding:20px;}
    h1{font-size:20px;}
    h2{font-size:16px;margin-top:20px;}
    ol{padding-left:20px;}
    li{margin-bottom:4px;font-size:14px;}
  </style></head><body>
  <h1>é¸æŠæŠ€ä¸€è¦§</h1>

  <h2>æ±ºå‹ç·¨æˆ</h2>
  ${finals.length? "<ol>"+finals.map(t=>"<li>"+t+"</li>").join("")+"</ol>" : "æœªè¨­å®š"}

  <h2>äºˆé¸ ç¬¬1ãƒ©ã‚¦ãƒ³ãƒ‰</h2>
  ${p1.length? "<ol>"+p1.map(t=>"<li>"+t+"</li>").join("")+"</ol>" : "æœªè¨­å®š"}

  <h2>äºˆé¸ ç¬¬2ãƒ©ã‚¦ãƒ³ãƒ‰</h2>
  ${p2.length? "<ol>"+p2.map(t=>"<li>"+t+"</li>").join("")+"</ol>" : "æœªè¨­å®š"}

  </body></html>`);
  w.document.close();
  w.print();
}

/* --- æŠ€æ¤œç´¢ãƒãƒ¼ï¼ˆäºˆé¸ã®ã¿ï¼†ãƒ’ãƒƒãƒˆè‰²å¤‰æ›´ï¼‰ --- */
const searchInput=document.getElementById("trick-search");
searchInput.addEventListener("input",()=>{
  const q=searchInput.value.trim().toLowerCase();
  const preItems=document.querySelectorAll("#pre-tech-list .tech-item");
  preItems.forEach(item=>{
    const nameEl=item.querySelector(".tech-title");
    const text=nameEl?nameEl.textContent.toLowerCase():"";
    if(q && text.includes(q)){
      item.classList.add("search-hit");
    } else {
      item.classList.remove("search-hit");
    }
  });
});

updatePreSummary();
</script>

</body>
</html>
